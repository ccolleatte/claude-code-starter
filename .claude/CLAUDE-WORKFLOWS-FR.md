# CLAUDE-WORKFLOWS-FR.md - Flux de Travail D√©taill√©s v4.1

Guide op√©rationnel complet pour le Framework de Configuration Claude Code.

## üîß Configuration initiale

### Pr√©-requis
- Node.js ‚â•16.0.0
- Python ‚â•3.8.0
- Git configur√©
- √âditeur avec support Markdown

### Configuration rapide
```bash
# 1. Cloner le framework
git clone https://github.com/ccolleatte/claude-code-starter.git
cd claude-code-starter

# 2. Configuration environnement
cp .env.example .env
# √âditer .env avec tes cl√©s API

# 3. Validation initiale
npm run validate
npm test

# 4. Test serveurs MCP
bash .claude/scripts/serena-mcp.sh --validate
bash .claude/scripts/cipher-mcp.sh --validate
```

### Structure workspace
```
project/
‚îú‚îÄ‚îÄ .claude/          # Config Claude v4.1
‚îú‚îÄ‚îÄ .env             # Variables environnement  
‚îú‚îÄ‚îÄ .gitignore       # Exclusions Git
‚îú‚îÄ‚îÄ package.json     # Scripts npm
‚îî‚îÄ‚îÄ src/             # Code source
```

## üéØ Flux de travail TDD strict

### Cycle rouge-vert-refactorisation

#### 1. ROUGE - √âcrire Test Qui √âchoue
```bash
# Cr√©er nouveau test
echo "describe('myFunction', () => {
  test('should return expected result', () => {
    expect(myFunction(input)).toBe(expected)
  })
})" > tests/myFunction.test.js

# Ex√©cuter test (DOIT √©chouer)
npm test tests/myFunction.test.js
# ‚ùå ReferenceError: myFunction is not defined
```

#### 2. VERT - Code Minimal Pour Passer
```bash
# Cr√©er impl√©mentation minimale
echo "function myFunction(input) {
  return expected // Hard-cod√© pour passer test
}
module.exports = { myFunction }" > src/myFunction.js

# Test DOIT maintenant passer
npm test tests/myFunction.test.js
# ‚úÖ Tests: 1 passed, 1 total
```

#### 3. REFACTORISATION - Am√©liorer Sans Casser
```bash
# Am√©liorer impl√©mentation
vim src/myFunction.js
# Logique r√©elle remplace hard-coding

# V√©rifier que tout reste vert
npm test:all
# ‚úÖ Tests: X passed, X total
```

### R√®gles TDD strictes
1. **Jamais de code sans test qui √©choue d'abord**
2. **Code minimal juste pour passer le test**
3. **Refactoriser seulement quand tout est vert**
4. **1 √©chec = ARR√äT et corriger imm√©diatement**

## üîÑ Flux de travail Git standard

### Branches et conventions
```bash
# Cr√©ation branche feature
git checkout -b feature/add-user-authentication
git checkout -b fix/memory-leak-in-parser
git checkout -b refactor/optimize-query-performance

# Convention commits
git commit -m "feat: add JWT authentication"
git commit -m "fix: resolve memory leak in parser"
git commit -m "refactor: optimize database queries"
git commit -m "test: add unit tests for auth service"
git commit -m "docs: update API documentation"
```

### Flux de travail complet
```bash
# 1. Synchroniser avec main
git checkout main
git pull origin main

# 2. Cr√©er branche
git checkout -b feature/my-feature

# 3. D√©veloppement avec points de contr√¥le
git add . && git commit -m "checkpoint: basic structure"
# ... d√©veloppement ...
git add . && git commit -m "checkpoint: core logic implemented"
# ... tests ...
git add . && git commit -m "feat: complete feature implementation"

# 4. Validation pr√©-push
npm run ci:local
npm test:all

# 5. Push et PR
git push -u origin feature/my-feature
# Cr√©er Pull Request via interface GitHub
```

### R√®gles de S√©curit√© Git
```bash
# JAMAIS directement sur main
git checkout main && echo "‚ùå INTERDIT"

# TOUJOURS valider avant push
npm run validate || git reset --hard HEAD

# Protection contre push accidentel
git config --global push.default simple
git config --global push.autoSetupRemote true
```

## üß™ Flux de Travail Tests

### Hi√©rarchie Tests
```bash
# 1. Tests unitaires (rapides)
npm run test:unit
# Focus: Fonctions isol√©es

# 2. Tests int√©gration (mod√©r√©s)  
npm run test:integration
# Focus: Modules interconnect√©s

# 3. Tests end-to-end (lents)
npm run test:e2e
# Focus: Sc√©narios utilisateur complets
```

### Strat√©gies par Type de Code

#### Tests pour Fonctions Pures
```javascript
// ‚úÖ Bon test - fonction pure
test('calculateElo should return correct delta', () => {
  const result = calculateElo(1200, 1400, 32)
  expect(result).toBeCloseTo(24.7, 1)
  expect(result).toBeGreaterThan(0)
})
```

#### Tests pour APIs/Async
```javascript
// ‚úÖ Bon test - API async
test('fetchUser should return user data', async () => {
  const mockResponse = { id: 1, name: 'Test User' }
  fetchMock.mockResponseOnce(JSON.stringify(mockResponse))
  
  const user = await fetchUser(1)
  expect(user).toEqual(mockResponse)
  expect(fetchMock).toHaveBeenCalledWith('/api/users/1')
})
```

#### Tests pour Composants UI
```javascript
// ‚úÖ Bon test - composant React
test('Button should call onClick when clicked', () => {
  const mockClick = jest.fn()
  render(<Button onClick={mockClick}>Click me</Button>)
  
  fireEvent.click(screen.getByText('Click me'))
  expect(mockClick).toHaveBeenCalledTimes(1)
})
```

### Objectifs Coverage
- **Chemins critiques**: 100% de couverture
- **Logique m√©tier**: ‚â•95% de couverture  
- **Composants UI**: ‚â•85% de couverture
- **Utilitaires**: ‚â•90% de couverture

## üêõ Flux de Travail D√©bogage

### D√©bogage Syst√©matique
```bash
# 1. Reproduction du bug
npm test -- --watch failing-test.spec.js

# 2. Isoler le probl√®me
node --inspect-brk test-file.js
# Ouvrir Chrome DevTools

# 3. Logging strat√©gique
console.log('DEBUG:', { variable, context, timestamp: Date.now() })

# 4. Bisect Git si n√©cessaire
git bisect start
git bisect bad HEAD
git bisect good last-known-working-commit
```

### Outils de D√©bogage Recommand√©s
```bash
# D√©bogage Node.js
node --inspect-brk app.js
# Chrome://inspect

# D√©bogage Python
python -m pdb script.py
# (Pdb) commands

# D√©bogage r√©seau
curl -v https://api.example.com
# Ou utiliser Bruno/Postman

# Profilage performance
npm run benchmark
node --prof app.js && node --prof-process isolate-*.log
```

## üöÄ Flux de Travail CI/CD

### Pipeline Local (Pr√©-commit)
```bash
# Script validation compl√®te
#!/bin/bash
set -e

echo "üîç Linting..."
npm run lint

echo "üß™ Tests..."
npm test

echo "üîí Scan s√©curit√©..."
npm audit
npm run security:scan

echo "üì¶ Test build..."
npm run build

echo "‚úÖ Pr√™t √† commit!"
```

### Pipeline GitHub Actions
```yaml
name: Claude Validation
on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - run: npm ci
      - run: npm run validate
      - run: npm test
      - run: npm run build
```

## üîß Flux de Travail Serveurs MCP

### Configuration Serveurs
```bash
# Test connectivit√©
.claude/scripts/serena-mcp.sh --test
.claude/scripts/cipher-mcp.sh --test
.claude/scripts/semgrep-mcp.sh --test
.claude/scripts/exa-mcp.sh --test

# Debug connexion
MCP_DEBUG=1 .claude/scripts/serena-mcp.sh

# Red√©marrer si probl√®me
pkill -f "mcp-server" && sleep 2
.claude/scripts/serena-mcp.sh --restart
```

### Patterns d'Usage MCP
```bash
# Serena - Analyse de code
mcp__serena__list_dir "src/"
mcp__serena__find_symbol "calculateElo"
mcp__serena__replace_symbol_body "MyClass/myMethod" "nouvelle impl√©mentation"

# Cipher - M√©moire/Contexte
cipher store architecture "D√©cisions architecturales cl√©s..."
cipher recall patterns "authentication"

# Semgrep - S√©curit√©
semgrep --config=p/security src/
semgrep --config=p/owasp-top-10 .

# Exa - Documentation
exa search "React hooks best practices 2024"
exa search "Node.js performance optimization"
```

## üìä Flux de Travail Surveillance

### M√©triques Quotidiennes
```bash
# V√©rification matinale
scripts/claude-metrics.sh dashboard 24
scripts/claude-metrics.sh report yesterday

# Revue des alertes
grep "ALERT" .claude/metrics/claude-metrics.log | tail -10

# Baseline performance
npm run benchmark
scripts/claude-metrics.sh response-time "daily-check" $(date +%s.%3N)
```

### V√©rifications Sant√©
```bash
# Sant√© syst√®me
df -h                    # Espace disque
free -h                  # M√©moire
top -bn1 | head -20     # CPU/Processus

# Sant√© application
npm run health-check
curl -f http://localhost:3000/health || echo "Service down"

# Sant√© framework
npm run validate
npm test:quick
```

## üõ†Ô∏è Flux de Travail Maintenance

### Nettoyage Hebdomadaire
```bash
# Nettoyer d√©pendances
npm audit fix
npm outdated
npm update

# Nettoyer Git
git branch --merged | grep -v main | xargs git branch -d
git gc --prune=now

# Nettoyer logs
find . -name "*.log" -mtime +7 -delete
scripts/claude-metrics.sh cleanup 7

# Nettoyer cache
npm cache clean --force
rm -rf node_modules/.cache
```

### Mises √† Jour Mensuelles
```bash
# Mises √† jour d√©pendances
npm-check-updates -u
npm install
npm test

# Mises √† jour s√©curit√©
npm audit
npm run security:update

# Mises √† jour framework
git fetch origin
git merge origin/main
npm run migrate:check
```

## üéõÔ∏è Flux de Travail Multi-Terminal

### Disposition Terminal Recommand√©e
```bash
# Terminal 1: D√©veloppement
cd project/ && npm run dev

# Terminal 2: Tests en watch
npm run test:watch

# Terminal 3: Surveillance
watch -n 30 'scripts/claude-metrics.sh dashboard 1'

# Terminal 4: Commandes
# Terminal libre pour Git, npm, etc.
```

### Scripts Productivit√©
```bash
# Ajouts .bashrc
alias c="clear"
alias l="ls -la"
alias g="git"
alias n="npm"
alias t="npm test"
alias v="npm run validate"

# Sp√©cifiques Claude
alias cmetrics="scripts/claude-metrics.sh dashboard 24"
alias cvalidate="npm run ci:local"
alias ctests="npm run test:claude"
```

## üîÑ Flux de Travail Docker (Optionnel)

### Conteneur D√©veloppement
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
EXPOSE 3000
CMD ["npm", "run", "dev"]
```

### Commandes Docker
```bash
# Build image d√©veloppement
docker build -t claude-dev .

# Ex√©cuter avec montage volume
docker run -v $(pwd):/app -p 3000:3000 claude-dev

# Docker Compose pour services
docker-compose up -d database redis
npm run dev
```

## üìã Checklist Flux de Travail Complet

### Avant Chaque Session
- [ ] `git status` - √âtat propre
- [ ] `npm run validate` - Framework OK
- [ ] `scripts/claude-metrics.sh dashboard 1` - Sant√© syst√®me
- [ ] Objectifs session d√©finis

### Pendant D√©veloppement  
- [ ] TDD strict: Rouge ‚Üí Vert ‚Üí Refactorisation
- [ ] Commits fr√©quents avec messages clairs
- [ ] Tests passent en continu
- [ ] Pas de warnings/erreurs lint

### Avant Commit
- [ ] `npm run ci:local` - Validation compl√®te
- [ ] `npm test:all` - Tous tests passent
- [ ] `git diff` - Review changements
- [ ] Message commit descriptif

### Fin de Session
- [ ] Push branche si pr√™te
- [x] Session document√©e et valid√©e
- [ ] `scripts/claude-metrics.sh report` - M√©triques jour
- [ ] Nettoyage terminal/processus

---
**Version** : 4.1.0 | **Usage** : Op√©rations Quotidiennes | **Mise √† jour** : Continue